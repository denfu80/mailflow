project:
  name: MailFlow
  version: 1.1.0
  start_date: 2025-11-07
  description: Native Android app for AI-powered Todo extraction from Gmail, syncing with an external web app.

phases:
  - phase: 0
    name: "Project Foundation & Setup"
    duration: "N/A"
    priority: critical
    status: completed
    completed_date: 2025-11-06
    description: "The initial multi-module project setup, including core dependencies like Hilt, Room, WorkManager, and Google APIs, remains valid."

  - phase: 1
    name: "Refactoring & Simplification"
    duration: "1 Woche"
    priority: critical
    status: completed
    description: "Remove all code related to the multi-agent and chat functionalities to create a clean slate for the new features."

    tasks:
      - id: R1-T1
        name: "Remove Agent & Chat UI"
        description: "Delete all Jetpack Compose screens, ViewModels, and navigation entries related to agent management and chat."
        outcome: "A simplified UI structure with only a main screen and settings."
        acceptance_criteria:
          - "ChatScreen.kt, AgentListScreen.kt, CreateAgentScreen.kt are deleted."
          - "Associated ViewModels and Navigations routes are removed."
          - "The app compiles without the old UI."

      - id: R1-T2
        name: "Remove Agent & Chat Domain Logic"
        description: "Delete UseCases like CreateAgentUseCase and ChatWithAgentUseCase."
        outcome: "Domain layer only contains logic for syncing and processing emails for todos."
        acceptance_criteria:
          - "CreateAgentUseCase.kt and ChatWithAgentUseCase.kt are deleted."
          - "Domain module has no dependencies on agent-specific models."

      - id: R1-T3
        name: "Simplify Data Layer"
        description: "Remove Room entities for MailAgent and AgentContext, along with their DAOs and repositories. Remove YAML parser dependency."
        outcome: "A leaner data layer focused on logging and tracking processed emails."
        acceptance_criteria:
          - "MailAgentEntity.kt and AgentContextEntity.kt are deleted."
          - "The database schema is simplified."
          - "SnakeYAML dependency is removed from build files."

  - phase: 2
    name: "Core Logic for Todo Extraction"
    duration: "1-2 Wochen"
    priority: high
    status: pending
    description: "Implement the new core functionality: extracting todos from emails and posting them to an external API."

    tasks:
      - id: P2-T1
        name: "Define Todo API Client Interface"
        description: "Create a Hilt module and a repository with an interface for the external Todo API."
        outcome: "A swappable interface for the Todo API client."
        acceptance_criteria:
          - "TodoApiClient.kt interface exists in the data module."
          - "Hilt module provides a dummy implementation for testing."
          - "Interface includes methods like `addTodo(listName: String, title: String, body: String)`."

      - id: P2-T2
        name: "Adapt Email Processing Logic"
        description: "Modify ProcessEmailUseCase to use a specific Gemini prompt for todo extraction and call the TodoApiClient."
        outcome: "Emails are analyzed for todos, which are then sent to the external API."
        acceptance_criteria:
          - "Gemini prompt is hardcoded for todo extraction."
          - "UseCase correctly parses the AI response."
          - "TodoApiClient's `addTodo` method is called with the extracted data."
          - "The local database is used to prevent processing the same email twice."

      - id: P2-T3
        name: "Update Background Worker"
        description: "Update the EmailProcessingWorker to use the new UseCase."
        outcome: "The background task correctly triggers the new todo extraction logic."
        acceptance_criteria:
          - "WorkManager chain remains: GmailSyncWorker -> EmailProcessingWorker."
          - "The worker successfully injects and runs the updated ProcessEmailUseCase."

  - phase: 3
    name: "UI and User Configuration"
    duration: "1 Woche"
    priority: high
    status: pending
    description: "Build the new, simplified user interface."

    tasks:
      - id: P3-T1
        name: "Implement Activity Log Screen"
        description: "Create a main screen that shows a log of recent sync activities and created todos."
        outcome: "A simple, informative main screen."
        acceptance_criteria:
          - "Screen shows a list of log entries from a local database."
          - "Includes a 'Sync Now' button."
          - "Displays the status of the background worker."

      - id: P3-T2
        name: "Update Settings Screen"
        description: "Add a setting for the user to specify the name of the todo list."
        outcome: "User can configure the target list for new todos."
        acceptance_criteria:
          - "Settings screen has a text field for 'Todo List Name'."
          - "The value is saved using DataStore."
          - "The processing logic correctly uses this configured list name."

      - id: P3-T3
        name: "Adapt Notification System"
        description: "Change notifications to inform the user about newly created todos."
        outcome: "Users receive relevant notifications."
        acceptance_criteria:
          - "A notification is shown upon successful creation of a todo."
          - "The notification text includes the name of the todo and the list."

  - phase: 4
    name: "Final Integration & Testing"
    duration: "1 Woche"
    priority: medium
    status: pending
    description: "Replace dummy implementations and conduct end-to-end testing."

    tasks:
      - id: P4-T1
        name: "Implement Real Todo API Client"
        description: "Replace the dummy TodoApiClient with a real Retrofit implementation based on the provided API specs."
        outcome: "The app communicates with the real web service."
        acceptance_criteria:
          - "Retrofit client is implemented."
          - "API calls are correctly authenticated (if required)."
          - "Error handling for network and API errors is in place."

      - id: P4-T2
        name: "End-to-End Testing"
        description: "Test the full flow: receiving an email, processing it, and seeing the todo appear in the web app."
        outcome: "The entire workflow is verified."
        acceptance_criteria:
          - "Test with a real Gmail account."
          - "Verify that a todo is created in the external web app after sending a test email."
          - "Verify that notifications are displayed correctly."

future_phases:
  - name: "Advanced Configuration"
    features:
      - "Allow user to configure API endpoint and authentication token in settings."
      - "Add more sophisticated email filtering options in the UI."
      - "Allow user to customize the Gemini prompt."
